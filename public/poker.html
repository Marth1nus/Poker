<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poker</title>
    <link rel="stylesheet" href="poker.css" />
    <script type="module" src="poker.mjs"></script>
    <script>
      const ranks = Array.from("A23456789XJQK")
      const suits = Array.from("♣♦♥♠")
      const randI = ({ length }) => Math.floor(Math.random() * length)
      const randCard = () => `${ranks[randI(ranks)]}${suits[randI(suits)]}`
      const divCard = str => {
        const card = document.createElement("div")
        card.classList.add("card")
        card.setAttribute("title", str ?? randCard())
        card.setAttribute("rank", card.title[0])
        card.setAttribute("suit", card.title[1])
        return card
      }
      const replaceHere = (...nodes) => {
        if (nodes.length < 1) nodes.push(document.createElement("div"))
        document.currentScript.replaceWith(...nodes)
        return nodes
      }
      const seatsHere = (n = 1) => {
        const hand = document.querySelector(".hand")
        replaceHere(...Array.from({ length: n }, _ => hand.parentNode.cloneNode())).forEach(seat =>
          seat.replaceChildren(hand.cloneNode(true))
        )
      }
      document.addEventListener("DOMContentLoaded", event => {
        const table = document.querySelector("#poker-game > *:nth-child(1)")
        ;[...document.querySelectorAll(".hand")].forEach((hand, i) => {
          hand.children[0].replaceWith(divCard())
          hand.children[1].replaceWith(divCard())
          hand.children[2].innerHTML = `Player ${i + 1}`
        })
        setInterval(() => {
          const seats = [...table.children].splice(1)
          const i = seats.findIndex(s => s.hasAttribute("playing"))
          seats.at((i + 0) % seats.length).toggleAttribute("playing", false)
          seats.at((i + 1) % seats.length).toggleAttribute("playing", true)
        }, 2000)
      })
    </script>
  </head>
  <body>
    <main id="poker-game">
      <div>
        <div>
          <h1>Board</h1>
          <b>Pot :</b>
          <p>9999</p>
          <div class="card"></div>
          <div class="card"></div>
          <div class="card"></div>
          <div class="card"></div>
          <div class="card"></div>
        </div>
        <div>
          <div class="hand">
            <div class="card"></div>
            <div class="card"></div>
            <b>Player Name</b>
            <b> Bet :</b>
            <p>123</p>
            <b>Bank :</b>
            <p>456</p>
          </div>
        </div>
        <script>
          seatsHere(8)
        </script>
      </div>
    </main>
  </body>
</html>
